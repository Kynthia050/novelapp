<!DOCTYPE html> 
<html lang="th">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Myshelf ‚Äî Home</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg:    '#1f1f21',
            panel: '#232326',
            card:  '#2a2a2d',
            textc: '#f3f3f3',
            muted: '#c7c7cc',
            brand: '#ffffff'
          },
          boxShadow: {
            card: '0 4px 12px rgba(0,0,0,.35)',
            cardLg: '0 10px 24px rgba(0,0,0,.45)'
          },
          borderRadius: { xl2: '16px' },
          fontFamily: { serif: ['Georgia', 'ui-serif', 'serif'] }
        }
      }
    }
  </script>
  <style>

/* === Novel Card styles ported from test.html (scoped-safe) === */
:root{
      --bg:#232323;           
      --card:#2a2a2a;         
      --muted:#cfcfcf;        
      --text:#f5f5f5;         
      --ink:#ffffff;          
      --placeholder:#d9d9d9;  
      --shadow:0 10px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:"Playfair Display", ui-serif, Georgia, serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{
      display:flex;align-items:center;justify-content:space-between;
      padding:28px 40px 10px;
    }
    header h1{font-weight:900;letter-spacing:.12em;margin:0;text-transform:uppercase}
    header .hint{font: 500 14px/1.1 Inter, ui-sans-serif;opacity:.7}
    

    /* ‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ö‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) */
    .shelf{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:minmax(260px, 1fr);
      gap:36px;
      padding:22px 40px 40px;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      scrollbar-width:thin;
    }
    .shelf::-webkit-scrollbar{height:10px}
    .shelf::-webkit-scrollbar-thumb{background:#444;border-radius:8px}

    .card{scroll-snap-align:start}
    .card-inner{
      display:flex;flex-direction:column;
      gap:12px;
    }
    .cover{
      background:var(--placeholder);
      border-radius:8px;
      width:100%;
      aspect-ratio:1/1;
      position:relative; overflow:hidden;
      box-shadow:var(--shadow);
    }
    .cover img{
      width:100%;height:100%;object-fit:cover;display:block;
    }
    .title{
      margin-top:2px;
      text-transform:uppercase;
      letter-spacing:.38em;
      font-weight:900;
      font-size:20px;
    }
    .writer{
      font: 600 14px/1.2 Inter, ui-sans-serif;
      opacity:.9;color:var(--text);
    }
    .writer span{opacity:.7}
    .tagline{
      font-size:15px;line-height:1.55;color:var(--muted);
      white-space:pre-line;
    }
    .rating{display:flex;align-items:center;gap:10px}
    .stars{display:flex;gap:8px}
    .star{font-size:20px;line-height:1;color:var(--ink);opacity:.9}
    .star.dim{opacity:.25}
    .sr-only{position:absolute;left:-9999px}

    /* ‡∏™‡πÄ‡∏Å‡∏•‡πÄ‡∏•‡∏ï‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏•‡∏î */
    .skeleton .cover{background:#3a3a3a;position:relative;overflow:hidden}
    .skeleton .cover::after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.12) 45%, rgba(255,255,255,0) 90%);
      transform:translateX(-100%);
      animation:shimmer 1.4s infinite;
    }
    @keyframes shimmer{to{transform:translateX(100%)}}
    .skeleton .title,.skeleton .writer,.skeleton .tagline{background:#3a3a3a;border-radius:6px}
    .skeleton .title{height:20px;width:70%;}
    .skeleton .writer{height:16px;width:50%}
    .skeleton .tagline{height:34px;width:90%}

/* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏Å‡∏≠‡∏•‡∏ö‡∏≤‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡∏£‡πá‡∏Å‡∏Ñ‡∏≤‡∏£‡∏π‡πÄ‡∏ã‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
#track{-ms-overflow-style:none; scrollbar-width:none;}
#track::-webkit-scrollbar{display:none;}
  </style>
</head>
<body class="min-h-screen bg-bg text-textc font-serif">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-[rgba(31,31,33,.98)] bg-gradient-to-b from-[rgba(31,31,33,.98)] to-[rgba(31,31,33,.95)] backdrop-blur-sm border-b border-white/10">
    <div class="mx-auto max-w-[1200px] px-4 md:px-6">
      <nav class="flex items-center gap-4 py-3.5">
        <a href="/" class="shrink-0 inline-flex items-center gap-3">
          <img src="{{ url_for('static', filename='cover/logo.png') }}" alt="MY SHELF" class="h-[48px] md:h-[60px] w-auto object-contain" />
        </a>

        <div class="ml-auto flex items-center gap-2">
          <form class="header-search" action="{{ url_for('search.search_novels') }}" method="get">
            <button class="header-search-icon" type="submit" aria-label="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤">
              <!-- icon ‡πÅ‡∏ß‡πà‡∏ô‡∏Ç‡∏¢‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ -->
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <circle cx="11" cy="11" r="6" stroke="currentColor" fill="none" stroke-width="2"/>
                <line x1="15" y1="15" x2="21" y2="21" stroke="currentColor" stroke-width="2"
                      stroke-linecap="round"/>
              </svg>
            </button>
            <input
              type="search"
              name="q"
              placeholder="Search"
              value="{{ request.args.get('q', '') }}"
              autocomplete="off"
            />
          </form>


          {% set iconBtn = "w-9 h-9 rounded-full border border-white/10 bg-[#111214] text-muted grid place-items-center hover:border-white/20 hover:text-textc transition" %}
          <a href="{{ url_for('mywrite') }}"         class="{{ iconBtn }}" aria-label="‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô">‚úèÔ∏è</a>
          <button type="button" id="btnNotifications" class="{{ iconBtn }}" aria-haspopup="dialog" aria-controls="notificationsModal" aria-label="‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">üîî</button>
          <a href="{{ url_for('bookshelf') }}"     class="{{ iconBtn }}" aria-label="‡∏ä‡∏±‡πâ‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">‚ù§</a>
          <a href="{{ url_for('profile.profileusers') }}"       class="{{ iconBtn }}" aria-label="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">üë§</a>

        </div>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-[1200px] px-4 md:px-6 pb-16">
    <!-- Top 10 -->
    <section class="pt-7 relative" aria-labelledby="top10-title">
      <h2 id="top10-title"
          class="text-[clamp(18px,2vw,24px)] tracking-[.15em] font-bold mb-4">
        {{ month_label|default('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î') }}
      </h2>
    
      {% set items = top10 if top10 is defined and top10 else novels %}
    
      {% if items %}
      <div class="relative">
        <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏ß‡∏á‡∏Å‡∏•‡∏° -->
        <button id="prevBtn"
          class="absolute top-1/2 -translate-y-1/2 left-2 z-10 grid place-items-center
                 h-11 w-11 rounded-full bg-white/90 text-zinc-800 border border-black/10
                 shadow-xl hover:bg-white focus:outline-none focus:ring-2 focus:ring-black/5
                 disabled:opacity-40 disabled:cursor-not-allowed"
          aria-label="‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
    
        <button id="nextBtn"
          class="absolute top-1/2 -translate-y-1/2 right-2 z-10 grid place-items-center
                 h-11 w-11 rounded-full bg-white/90 text-zinc-800 border border-black/10
                 shadow-xl hover:bg-white focus:outline-none focus:ring-2 focus:ring-black/5
                 disabled:opacity-40 disabled:cursor-not-allowed"
          aria-label="‡∏ñ‡∏±‡∏î‡πÑ‡∏õ">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
    
        <!-- ‡πÅ‡∏ó‡∏£‡πá‡∏Å‡∏Ñ‡∏≤‡∏£‡∏π‡πÄ‡∏ã‡∏• -->
        <div id="track"
             class="no-scrollbar snap-x snap-mandatory overflow-x-auto scroll-smooth flex gap-8 pb-2"
             tabindex="0" aria-label="Top 10 carousel">
          {% for n in items %}
          <article class="card min-w-[85%] sm:min-w-[60%] md:min-w-[32%] snap-center" role="article">
            <div class="card-inner">
              <a class="cover" href="{{ url_for('novel.detail', novels_id=n.novels_id) }}" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢">
                {% if n.cover %}<img src="{{ n.cover }}" alt="{{ n.title }}" loading="lazy" />{% endif %}
              </a>
              <h3 class="title">{{ n.title }}</h3>
              <div class="writer"><span>Writer:</span> <strong>{{ n.author_username or n.author_name or "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö" }}</strong></div>
              <p class="tagline">{{ (n.description or "")|striptags|trim|truncate(140, True, "...") }}</p>
              {% set display_rate = (n.user_rating or 0) if n.user_rating else (n.avg_rating or 0) %}
              {% set rounded = (display_rate|round(0, "common")) %}
              <div class="rating">
                <span class="sr-only">‡πÄ‡∏£‡∏ï‡∏ï‡∏¥‡πâ‡∏á {{ display_rate|round(1) }} ‡∏à‡∏≤‡∏Å 5 ‡∏î‡∏≤‡∏ß</span>
                <div class="stars">
                  {% for i in range(1,6) %}
                    <span class="star {{ "" if i <= rounded else "dim" }}" aria-hidden="true">‚òÖ</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </div>
      {% else %}
        <p class="opacity-70">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ</p>
      {% endif %}
    </section>


  </main>

  <!-- Hidden template for star styling -->
  <template class="hidden">
    <span class="text-yellow-400"></span>
  </template>

  <!-- Notifications Modal -->
    <div id="notificationsModal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="notiTitle">
      <div id="notiBackdrop" class="absolute inset-0 bg-black/50" data-close="1"></div>
      <div class="absolute inset-0 flex items-start md:items-center justify-center p-4 md:p-6 overflow-y-auto">
        <div class="relative w-full max-w-md bg-white rounded-2xl shadow-2xl ring-1 ring-slate-200" id="notiContainer">
          <button type="button" class="absolute top-3 right-3 p-2 rounded-lg hover:bg-slate-100" aria-label="‡∏õ‡∏¥‡∏î" id="notiClose">‚úï</button>
          {% set container_id = 'notiContent' %}
          {% include 'notification_panel.html' %}
        </div>
      </div>
    </div>



  <!-- Notifications modal loader -->
 <!-- Notifications modal (remote-style) -->
<script>
  (function () {
    const btn   = document.getElementById('btnNotifications');

    // --- remote-modal style bindings ---
    const modal   = document.getElementById('notificationsModal'); // ‡πÄ‡∏î‡∏¥‡∏°: remoteModal
    const closeBtn= document.getElementById('notiClose');          // ‡πÄ‡∏î‡∏¥‡∏°: remoteClose
    const iframe  = null; // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏™‡πà <iframe id="notiFrame"> ‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏±‡∏•‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô document.getElementById('notiFrame')

    function openModal(){
      modal.classList.remove('hidden');
      modal.classList.add('flex'); // ‡∏ï‡∏±‡∏ß wrapper ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö layout ‡πÄ‡∏î‡∏¥‡∏°
    }

    function closeModal(){
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      if (iframe) iframe.src = 'about:blank';
    }

    // ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
    closeBtn?.addEventListener('click', (e)=>{ e.preventDefault(); closeModal(); });

    // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö data-close="1")
    modal?.addEventListener('mousedown', (e)=>{
      if (e.target === modal || e.target?.getAttribute?.('data-close') === '1') closeModal();
    });

    // ‡∏õ‡∏∏‡πà‡∏° Esc ‡∏õ‡∏¥‡∏î
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeModal(); });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    btn && btn.addEventListener('click', async () => {
      openModal();
      const mountId = 'notiContent';
      const content = document.getElementById(mountId);
      if (content) content.innerHTML = '<div class="p-6 text-center text-slate-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
      try {
        const res  = await fetch('{{ url_for("noti.notifications_page") }}?container_id=' + mountId, { headers: { 'X-Requested-With': 'fetch' } });
        const html = await res.text();
        const current = document.getElementById(mountId);
        if (current) current.outerHTML = html;
      } catch (e) {
        if (content) content.innerHTML = '<div class="p-6 text-center text-red-600">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
      }
    });
  })();
</script>


  <!-- Carousel script: scroll/keyboard/autoplay -->
  <script>
    (function(){
      const track = document.getElementById('track');
      const prev  = document.getElementById('prevBtn');
      const next  = document.getElementById('nextBtn');
      if(!track || !prev || !next) return;

      const step = () => Math.max(track.clientWidth * 0.66, 280);

      function updateNav(){
        const max = track.scrollWidth - track.clientWidth - 1;
        prev.disabled = track.scrollLeft <= 0;
        next.disabled = track.scrollLeft >= max;
      }

      prev.addEventListener('click', ()=> track.scrollBy({left: -step(), behavior: 'smooth'}));
      next.addEventListener('click', ()=> track.scrollBy({left:  step(), behavior: 'smooth'}));

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô/‡∏£‡∏µ‡πÑ‡∏ã‡∏™‡πå/‡πÇ‡∏´‡∏•‡∏î
      track.addEventListener('scroll', ()=> requestAnimationFrame(updateNav));
      window.addEventListener('resize', updateNav);
      window.addEventListener('load', updateNav);
      updateNav();

      // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î
      track.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowRight') next.click();
        if(e.key === 'ArrowLeft')  prev.click();
      });

      // ‡∏≠‡∏≠‡πÇ‡∏ï‡πâ‡πÄ‡∏û‡∏•‡∏¢‡πå (‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏Æ‡πÄ‡∏ß‡∏≠‡∏£‡πå/‡πÇ‡∏ü‡∏Å‡∏±‡∏™)
      let timer = setInterval(()=> next.click(), 4000);
      const stop = ()=> { clearInterval(timer); timer = null; };
      const start = ()=> { if(!timer) timer = setInterval(()=> next.click(), 4000); };
      track.addEventListener('mouseenter', stop);
      track.addEventListener('mouseleave', start);
      track.addEventListener('focusin', stop);
      track.addEventListener('focusout', start);
    })();
  </script>
</body>
</html>
