<!DOCTYPE html> 
<html lang="th">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Myshelf — Home</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg:    '#1f1f21',
            panel: '#232326',
            card:  '#2a2a2d',
            textc: '#f3f3f3',
            muted: '#c7c7cc',
            brand: '#ffffff'
          },
          boxShadow: {
            card: '0 4px 12px rgba(0,0,0,.35)',
            cardLg: '0 10px 24px rgba(0,0,0,.45)'
          },
          borderRadius: { xl2: '16px' },
          fontFamily: { serif: ['Georgia', 'ui-serif', 'serif'] }
        }
      }
    }
  </script>
  <style>

    /* === Novel Card styles ported from test.html (scoped-safe) === */
    :root{
      --bg:#232323;           
      --card:#2a2a2a;         
      --muted:#cfcfcf;        
      --text:#f5f5f5;         
      --ink:#ffffff;          
      --placeholder:#d9d9d9;  
      --shadow:0 10px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:"Playfair Display", ui-serif, Georgia, serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* ชั้นวางการ์ดแบบแนวนอน (อิงจากภาพตัวอย่าง) */
    .shelf{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:minmax(260px, 1fr);
      gap:36px;
      padding:22px 40px 40px;
      overflow-x:auto;
      scroll-snap-type:x mandatory;
      scrollbar-width:thin;
    }
    .shelf::-webkit-scrollbar{height:10px}
    .shelf::-webkit-scrollbar-thumb{background:#444;border-radius:8px}

    .card{scroll-snap-align:start}
    .card-inner{
      display:flex;flex-direction:column;
      gap:12px;
    }
    .cover{
      background:var(--placeholder);
      border-radius:8px;
      width:100%;
      aspect-ratio:1/1;
      position:relative; overflow:hidden;
      box-shadow:var(--shadow);
    }
    .cover img{
      width:100%;height:100%;object-fit:cover;display:block;
    }
    .title{
      margin-top:2px;
      text-transform:uppercase;
      letter-spacing:.38em;
      font-weight:900;
      font-size:20px;
    }
    .writer{
      font: 600 14px/1.2 Inter, ui-sans-serif;
      opacity:.9;color:var(--text);
    }
    .writer span{opacity:.7}
    .tagline{
      font-size:15px;line-height:1.55;color:var(--muted);
      white-space:pre-line;
    }
    .rating{display:flex;align-items:center;gap:10px}
    .stars{display:flex;gap:8px}
    .star{font-size:20px;line-height:1;color:var(--ink);opacity:.9}
    .star.dim{opacity:.25}
    .sr-only{position:absolute;left:-9999px}

    /* สเกลเลตันระหว่างโหลด */
    .skeleton .cover{background:#3a3a3a;position:relative;overflow:hidden}
    .skeleton .cover::after{
      content:"";position:absolute;inset:0;
      background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.12) 45%, rgba(255,255,255,0) 90%);
      transform:translateX(-100%);
      animation:shimmer 1.4s infinite;
    }
    @keyframes shimmer{to{transform:translateX(100%)}}
    .skeleton .title,.skeleton .writer,.skeleton .tagline{background:#3a3a3a;border-radius:6px}
    .skeleton .title{height:20px;width:70%;}
    .skeleton .writer{height:16px;width:50%}
    .skeleton .tagline{height:34px;width:90%}

    /* ซ่อนสกอลบาร์ของแทร็กคารูเซลเท่านั้น */
    #track{-ms-overflow-style:none; scrollbar-width:none;}
    #track::-webkit-scrollbar{display:none;}
  </style>
</head>
<body class="min-h-screen bg-bg text-textc font-serif">

  {# Header รวมจากไฟล์ header.html #}
  {% include 'header.html' %}

  <main class="mx-auto max-w-[1200px] px-4 md:px-6 pb-16">
    <!-- Top 10 -->
    <section class="pt-7 relative" aria-labelledby="top10-title">
      <h2 id="top10-title"
          class="text-[clamp(18px,2vw,24px)] tracking-[.15em] font-bold mb-4">
        {{ month_label|default('อัปเดตล่าสุด') }}
      </h2>
    
      {% set items = top10 if top10 is defined and top10 else novels %}
    
      {% if items %}
      <div class="relative">
        <!-- ปุ่มเลื่อนแบบวงกลม -->
        <button id="prevBtn"
          class="absolute top-1/2 -translate-y-1/2 left-2 z-10 grid place-items-center
                 h-11 w-11 rounded-full bg-white/90 text-zinc-800 border border-black/10
                 shadow-xl hover:bg-white focus:outline-none focus:ring-2 focus:ring-black/5
                 disabled:opacity-40 disabled:cursor-not-allowed"
          aria-label="ก่อนหน้า">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
    
        <button id="nextBtn"
          class="absolute top-1/2 -translate-y-1/2 right-2 z-10 grid place-items-center
                 h-11 w-11 rounded-full bg-white/90 text-zinc-800 border border-black/10
                 shadow-xl hover:bg-white focus:outline-none focus:ring-2 focus:ring-black/5
                 disabled:opacity-40 disabled:cursor-not-allowed"
          aria-label="ถัดไป">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
               class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
    
        <!-- แทร็กคารูเซล -->
        <div id="track"
             class="no-scrollbar snap-x snap-mandatory overflow-x-auto scroll-smooth flex gap-8 pb-2"
             tabindex="0" aria-label="Top 10 carousel">
          {% for n in items %}
          <article class="card min-w-[85%] sm:min-w-[60%] md:min-w-[32%] snap-center" role="article">
            <div class="card-inner">
              <a class="cover" href="{{ url_for('novel.detail', novels_id=n.novels_id) }}" aria-label="เปิดดูรายละเอียดนิยาย">
                {% if n.cover %}<img src="{{ n.cover }}" alt="{{ n.title }}" loading="lazy" />{% endif %}
              </a>
              <h3 class="title">{{ n.title }}</h3>
              <div class="writer"><span>Writer:</span> <strong>{{ n.author_username or n.author_name or "ไม่ทราบ" }}</strong></div>
              <p class="tagline">{{ (n.description or "")|striptags|trim|truncate(140, True, "...") }}</p>
              {% set display_rate = (n.user_rating or 0) if n.user_rating else (n.avg_rating or 0) %}
              {% set rounded = (display_rate|round(0, "common")) %}
              <div class="rating">
                <span class="sr-only">เรตติ้ง {{ display_rate|round(1) }} จาก 5 ดาว</span>
                <div class="stars">
                  {% for i in range(1,6) %}
                    <span class="star {{ "" if i <= rounded else "dim" }}" aria-hidden="true">★</span>
                  {% endfor %}
                </div>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
      </div>
      {% else %}
        <p class="opacity-70">ยังไม่มีรายการในช่วงนี้</p>
      {% endif %}
    </section>
  </main>

  <!-- Hidden template for star styling -->
  <template class="hidden">
    <span class="text-yellow-400"></span>
  </template>

  <!-- Carousel script: scroll/keyboard/autoplay -->
  <script>
    (function(){
      const track = document.getElementById('track');
      const prev  = document.getElementById('prevBtn');
      const next  = document.getElementById('nextBtn');
      if(!track || !prev || !next) return;

      const step = () => Math.max(track.clientWidth * 0.66, 280);

      function updateNav(){
        const max = track.scrollWidth - track.clientWidth - 1;
        prev.disabled = track.scrollLeft <= 0;
        next.disabled = track.scrollLeft >= max;
      }

      prev.addEventListener('click', ()=> track.scrollBy({left: -step(), behavior: 'smooth'}));
      next.addEventListener('click', ()=> track.scrollBy({left:  step(), behavior: 'smooth'}));

      // อัปเดตสถานะปุ่มระหว่างเลื่อน/รีไซส์/โหลด
      track.addEventListener('scroll', ()=> requestAnimationFrame(updateNav));
      window.addEventListener('resize', updateNav);
      window.addEventListener('load', updateNav);
      updateNav();

      // คีย์บอร์ด
      track.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowRight') next.click();
        if(e.key === 'ArrowLeft')  prev.click();
      });

      // ออโต้เพลย์ (หยุดเมื่อโฮเวอร์/โฟกัส)
      let timer = setInterval(()=> next.click(), 4000);
      const stop = ()=> { clearInterval(timer); timer = null; };
      const start = ()=> { if(!timer) timer = setInterval(()=> next.click(), 4000); };
      track.addEventListener('mouseenter', stop);
      track.addEventListener('mouseleave', start);
      track.addEventListener('focusin', stop);
      track.addEventListener('focusout', start);
    })();
  </script>
</body>
</html>
