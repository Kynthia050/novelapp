<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Myshelf ‚Äî Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Light neutral theme (white/black/gray) */
      --bg:#f3f4f6;          /* page background */
      --bg-2:#eef0f3;        /* subtle section */
      --panel:#ffffff;       /* card surface */
      --panel-2:#f9fafb;     /* card inner */
      --muted:#6b7280;       /* secondary text */
      --text:#111827;        /* primary text */
      --accent:#111111;      /* primary action */
      --accent-2:#2563eb;    /* charts/accent optional */
      --stroke:rgba(17,24,39,.10); /* borders/lines */
      --radius:16px; --shadow:0 10px 28px rgba(17,24,39,.08);
    }
    *{box-sizing:border-box}
    body{background:linear-gradient(180deg, var(--bg), var(--bg-2) 40%); color:var(--text); font-family:'Noto Sans Thai',system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
    .card{background:linear-gradient(180deg, var(--panel), var(--panel-2));
          border:1px solid var(--stroke); border-radius:var(--radius); box-shadow:var(--shadow);}
    .chip{border:1px solid var(--stroke); background:#f3f4f6; padding:.25rem .6rem; border-radius:999px; font-size:.75rem; color:var(--muted)}
    .btn{display:inline-flex; align-items:center; gap:.5rem; border:1px solid var(--stroke); border-radius:14px; padding:.6rem .9rem}
    .btn-primary{background:var(--accent); color:#ffffff; box-shadow:0 8px 20px rgba(0,0,0,.12)}
    .btn-ghost{background:transparent; color:var(--text)}
    .grid-auto{display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:1rem}
    .hide{display:none!important}
    /* Improve select readability */
    select{background:linear-gradient(180deg,var(--panel),var(--panel-2)); color:var(--text); border:1px solid var(--stroke); border-radius:12px}
    select:focus{outline:none; box-shadow:0 0 0 2px rgba(17,24,39,.2)}
    select option{background:#ffffff; color:#111827}
    select option:checked, select option:hover{background:#f3f4f6; color:#111827}
    /* Accent separators and headings */
    h1,h2,h3{letter-spacing:.2px}
    .accent{color:var(--accent)}
  </style>
</head>
<body>
  <!-- Layout -->
  <div class="min-h-screen flex">
    <!-- Sidebar -->
    <aside class="w-72 hidden lg:flex flex-col gap-4 p-4 border-r border-[var(--stroke)] bg-[#0d1016]">
      <div class="flex items-center gap-3 px-2">
        <div class="w-10 h-10 rounded-full overflow-hidden ring-2 ring-white/10">
          <img src="/static/img/admin-avatar.png" class="w-full h-full object-cover" alt="">
        </div>
        <div>
          <div class="font-semibold">Welcome, <span id="whoami">Admin</span></div>
          <div class="text-xs text-[var(--muted)]">Myshelf Console</div>
        </div>
      </div>
      <nav class="mt-2 flex-1 text-[15px]">
        <ul class="space-y-1">
          <li><a href="#home" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5">üè† Dashboard</a></li>
          <li><a href="#novels" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5">üìö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</a></li>
          <li><a href="#users" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</a></li>
          <li><a href="#reports" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5">üö© Report Center</a></li>
          <li><a href="#profile" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/5">‚öôÔ∏è ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
        </ul>
      </nav>
      <div class="px-2">
        <button class="btn btn-ghost w-full" id="btnLogout">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
      <div class="px-2">
        <div class="chip">UI based on provided GIF</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-4 md:p-6 lg:p-8 space-y-6">
      <!-- Topbar -->
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <button class="lg:hidden btn btn-ghost">‚ò∞</button>
          <h1 class="text-2xl md:text-3xl font-bold tracking-tight">Dashboard</h1>
          <span class="chip" id="roleChip">role: admin</span>
        </div>
        <div class="flex items-center gap-3">
          <input type="month" id="monthPicker" class="card px-3 py-2 outline-none bg-transparent" />
          <button id="btnExport" class="btn btn-primary">‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF</button>
        </div>
      </div>

      <!-- KPIs -->
      <section id="home" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
        <div class="card p-4">
          <div class="text-sm text-[var(--muted)]">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div class="mt-2 text-3xl font-semibold" id="kpiUsers">‚Äî</div>
          <canvas id="sparkUsers" height="60"></canvas>
        </div>
        <div class="card p-4">
          <div class="text-sm text-[var(--muted)]">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div class="mt-2 text-3xl font-semibold" id="kpiNovels">‚Äî</div>
          <canvas id="sparkNovels" height="60"></canvas>
        </div>
        <div class="card p-4">
          <div class="text-sm text-[var(--muted)]">Report ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà</div>
          <div class="mt-2 text-3xl font-semibold" id="kpiReportsOpen">‚Äî</div>
          <div class="mt-1 text-xs text-[var(--muted)]" id="kpiReportBreakdown"></div>
        </div>
        <div class="card p-4">
          <div class="text-sm text-[var(--muted)]">Top ‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)</div>
          <div class="mt-2 font-medium" id="kpiTopNovel">‚Äî</div>
          <div class="text-xs text-[var(--muted)]">‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô</div>
        </div>
      </section>

      <!-- Charts -->
      <section class="grid grid-cols-1 xl:grid-cols-3 gap-4">
        <div class="card p-4 xl:col-span-2">
          <div class="flex items-center justify-between">
            <h2 class="font-semibold">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î (Categories)</h2>
          </div>
          <canvas id="chartByCategory" height="120"></canvas>
        </div>
        <div class="card p-4">
          <h2 class="font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Report</h2>
          <canvas id="chartReportStatus" height="120"></canvas>
        </div>
        <div class="card p-4">
          <h2 class="font-semibold">‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü‡∏£‡∏≤‡∏¢‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ)</h2>
          <canvas id="chartActiveReaders" height="160"></canvas>
        </div>
        <div class="card p-4 xl:col-span-2">
          <h2 class="font-semibold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏¥‡∏¢‡∏° (Bayesian Avg)</h2>
          <canvas id="chartBayesian" height="120"></canvas>
        </div>
      </section>

      <!-- Manage Novels (admin+superadmin) -->
      <section id="novels" class="card p-4" data-roles="admin,superadmin">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</h2>
          <span class="chip">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: Admin &amp; Superadmin</span>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="w-full text-sm">
            <thead class="text-left text-[var(--muted)] border-b border-[var(--stroke)]">
              <tr>
                <th class="py-2">ID</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                <th>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô</th>
                <th>‡∏´‡∏°‡∏ß‡∏î</th>
                <th>‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="text-right">Action</th>
              </tr>
            </thead>
            <tbody id="novelRows"></tbody>
          </table>
        </div>
      </section>

      <!-- Manage Users (admin+superadmin for role=user) -->
      <section id="users" class="card p-4" data-roles="admin,superadmin">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Role = user)</h2>
          <span class="chip">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: Admin &amp; Superadmin</span>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="w-full text-sm">
            <thead class="text-left text-[var(--muted)] border-b border-[var(--stroke)]">
              <tr>
                <th class="py-2">ID</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡πÄ‡∏û‡∏®</th>
                <th class="text-right">Action</th>
              </tr>
            </thead>
            <tbody id="userRows"></tbody>
          </table>
        </div>
      </section>

      <!-- Manage Admins (superadmin only) -->
      <section id="admins" class="card p-4" data-roles="superadmin">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Role = admin)</h2>
          <span class="chip">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: Superadmin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</span>
        </div>
        <div class="overflow-x-auto mt-3">
          <table class="w-full text-sm">
            <thead class="text-left text-[var(--muted)] border-b border-[var(--stroke)]">
              <tr>
                <th class="py-2">ID</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="text-right">Action</th>
              </tr>
            </thead>
            <tbody id="adminRows"></tbody>
          </table>
        </div>
      </section>

      <!-- Reports Center -->
      <section id="reports" class="card p-4" data-roles="admin,superadmin">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">Report Center</h2>
          <span class="chip">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: Admin &amp; Superadmin</span>
        </div>
        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-2">
          <select id="filterStatus" class="card px-3 py-2 bg-transparent">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
            <option>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
            <option>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
            <option>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option>
          </select>
          <input id="filterKeyword" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î / ‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô / ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢..."
                 class="card px-3 py-2 bg-transparent"/>
          <button class="btn btn-ghost" id="btnClearFilter">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
        </div>

        <div class="overflow-x-auto mt-3">
          <table class="w-full text-sm">
            <thead class="text-left text-[var(--muted)] border-b border-[var(--stroke)]">
              <tr>
                <th class="py-2">ID</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</th>
                <th>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</th>
                <th>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="text-right">Action</th>
              </tr>
            </thead>
            <tbody id="reportRows"></tbody>
          </table>
        </div>
      </section>

      <!-- My Profile (admin & superadmin) -->
      <section id="profile" class="card p-4" data-roles="admin,superadmin">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-semibold">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
          <span class="chip">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</span>
        </div>
        <form class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-[var(--muted)]">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
            <input id="pf_username" class="w-full card px-3 py-2 bg-transparent" />
          </div>
          <div>
            <label class="text-sm text-[var(--muted)]">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input id="pf_email" type="email" class="w-full card px-3 py-2 bg-transparent" />
          </div>
          <div>
            <label class="text-sm text-[var(--muted)]">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input id="pf_password" type="password" class="w-full card px-3 py-2 bg-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>
          <div>
            <label class="text-sm text-[var(--muted)]">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</label>
            <input id="pf_pic" type="file" class="w-full card px-3 py-2 bg-transparent" />
          </div>
          <div class="md:col-span-2 flex justify-end gap-2">
            <button class="btn btn-ghost" type="reset">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-primary" type="button" id="pf_save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
        </form>
      </section>

      <footer class="py-6 text-center text-xs text-[var(--muted)]">
        ¬© Myshelf Admin Console
      </footer>
    </main>
  </div>

  <script>
    // ====== CONFIG / MOCK ======
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î role ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å session/backend)
    let userRole = "admin"; // "admin" | "superadmin"
    document.getElementById("whoami").textContent = userRole.toUpperCase();
    document.getElementById("roleChip").textContent = "role: " + userRole;

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÉ‡∏´‡πâ backend ‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏≤‡∏° schema)
    const mockData = {
      siteTotals: { total_users: 3124, total_novels: 867 }, // ‡∏à‡∏≤‡∏Å v_site_totals
      reportStatusCounts: { "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö": 18, "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö": 6, "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß": 120 },
      byCategory: [
        { name: "Fantasy", total: 180 },
        { name: "Romance", total: 220 },
        { name: "Mystery", total: 90 },
        { name: "Sci-Fi", total: 70 },
        { name: "Drama", total: 110 }
      ],
      activeReaders: [ // ‡∏à‡∏≤‡∏Å v_monthly_active_readers_by_novel
        { title: "‡∏î‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏≤‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", readers: 512 },
        { title: "‡∏£‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á", readers: 410 },
        { title: "‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏§‡∏´‡∏≤‡∏™‡∏ô‡πå", readers: 265 },
        { title: "‡∏ó‡∏∞‡∏•‡∏ß‡∏á‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", readers: 233 }
      ],
      ratings: [
        { title: "‡∏î‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏≤‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", bayesian: 4.52 },
        { title: "‡∏£‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á", bayesian: 4.35 },
        { title: "‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏§‡∏´‡∏≤‡∏™‡∏ô‡πå", bayesian: 4.08 },
        { title: "‡∏ó‡∏∞‡∏•‡∏ß‡∏á‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", bayesian: 3.92 }
      ],
      novels: [
        { id: 1001, title: "‡∏î‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏≤‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", author: "alice", cate: "Fantasy", status: "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà" },
        { id: 1003, title: "‡∏£‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á", author: "carl", cate: "Romance", status: "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà" },
        { id: 1004, title: "‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏§‡∏´‡∏≤‡∏™‡∏ô‡πå", author: "ben", cate: "Mystery", status: "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà" }
      ],
      categories: ["Fantasy","Romance","Mystery","Sci-Fi","Drama"],
      usersUserRole: [
        { id: 101, username: "alice", email: "alice@test.local", status: "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥", gender:"‡∏´‡∏ç‡∏¥‡∏á" },
        { id: 102, username: "ben", email: "ben@test.local", status: "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥", gender:"‡∏ä‡∏≤‡∏¢" }
      ],
      admins: [
        { id: 3, username: "test0", email: "st21377@phatthara.ac.th", status: "‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥" }
      ],
      reports: [
        { id: 12, created_at: "2025-09-01 10:12", reporter:"alice", target:"novel#1001", reason:"spam / spam_ads", status:"‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" },
        { id: 13, created_at: "2025-09-02 09:00", reporter:"ben", target:"comment#3401", reason:"abuse", status:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" },
        { id: 14, created_at: "2025-09-02 15:35", reporter:"carol", target:"user#109", reason:"other", status:"‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß" }
      ],
      me: { username:"admin", email:"admin@example.com" }
    };

    // ====== Role Gate ======
    function applyRoleGate(){
      document.querySelectorAll("[data-roles]").forEach(sec=>{
        const allow = sec.getAttribute("data-roles").split(",").map(s=>s.trim());
        if(!allow.includes(userRole)){ sec.classList.add("hide"); }
      });
    }
    applyRoleGate();

    // ====== KPIs ======
    document.getElementById("kpiUsers").textContent = mockData.siteTotals.total_users.toLocaleString();
    document.getElementById("kpiNovels").textContent = mockData.siteTotals.total_novels.toLocaleString();
    const openReports = (mockData.reportStatusCounts["‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0) + (mockData.reportStatusCounts["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0);
    document.getElementById("kpiReportsOpen").textContent = openReports;
    document.getElementById("kpiReportBreakdown").textContent =
      `‡∏£‡∏≠: ${mockData.reportStatusCounts["‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0} ‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏¢‡∏π‡πà: ${mockData.reportStatusCounts["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0} ‚Ä¢ ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß: ${mockData.reportStatusCounts["‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß"]||0}`;

    document.getElementById("kpiTopNovel").textContent = mockData.activeReaders[0]?.title || "‚Äî";

    // Little spark charts
    const sparkCfg = (ctx, data)=>new Chart(ctx,{type:"line",data:{labels:data.map((_,i)=>i+1),datasets:[{data,borderWidth:2,tension:.4,pointRadius:0}]},options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}});
    sparkCfg(document.getElementById("sparkUsers"), [5,9,7,12,9,14,18]);
    sparkCfg(document.getElementById("sparkNovels"), [2,3,2,4,6,7,9]);

    // ====== Charts ======
    new Chart(document.getElementById("chartByCategory"),{
      type:"bar",
      data:{
        labels: mockData.byCategory.map(x=>x.name),
        datasets:[{label:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á", data: mockData.byCategory.map(x=>x.total)}]
      },
      options:{plugins:{legend:{display:false}}}
    });

    new Chart(document.getElementById("chartReportStatus"),{
      type:"doughnut",
      data:{
        labels:Object.keys(mockData.reportStatusCounts),
        datasets:[{data:Object.values(mockData.reportStatusCounts)}]
      }
    });

    new Chart(document.getElementById("chartActiveReaders"),{
      type:"bar",
      data:{
        labels:mockData.activeReaders.map(x=>x.title),
        datasets:[{label:"‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏Ñ‡∏ó‡∏µ‡∏ü (‡∏Ñ‡∏ô)", data:mockData.activeReaders.map(x=>x.readers)}]
      },
      options:{indexAxis:"y", plugins:{legend:{display:false}}}
    });

    new Chart(document.getElementById("chartBayesian"),{
      type:"line",
      data:{
        labels:mockData.ratings.map(x=>x.title),
        datasets:[{label:"Bayesian Avg", data:mockData.ratings.map(x=>x.bayesian), borderWidth:2, tension:.3}]
      }
    });

    // ====== Tables render ======
    // Novels
    const novelRows = document.getElementById("novelRows");
    novelRows.innerHTML = mockData.novels.map(n=>`
      <tr class="border-b border-[var(--stroke)]">
        <td class="py-2">${n.id}</td>
        <td>${n.title}</td>
        <td>${n.author}</td>
        <td>${n.cate}</td>
        <td>
          <select class="card bg-transparent px-2 py-1">
            ${mockData.categories.map(c=>`<option ${c===n.cate?'selected':''}>${c}</option>`).join("")}
          </select>
        </td>
        <td>${n.status}</td>
        <td class="text-right">
          <button class="btn btn-ghost">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn btn-ghost">‡∏•‡∏ö</button>
        </td>
      </tr>
    `).join("");

    // Users (role=user)
    const userRows = document.getElementById("userRows");
    userRows.innerHTML = mockData.usersUserRole.map(u=>`
      <tr class="border-b border-[var(--stroke)]">
        <td class="py-2">${u.id}</td>
        <td>${u.username}</td>
        <td>${u.email}</td>
        <td>${u.status}</td>
        <td>${u.gender}</td>
        <td class="text-right">
          <button class="btn btn-ghost">‡∏î‡∏π</button>
          <button class="btn btn-ghost">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn btn-ghost">‡∏•‡∏ö</button>
        </td>
      </tr>
    `).join("");

    // Admins (visible to superadmin only)
    const adminRows = document.getElementById("adminRows");
    adminRows.innerHTML = (mockData.admins||[]).map(u=>`
      <tr class="border-b border-[var(--stroke)]">
        <td class="py-2">${u.id}</td>
        <td>${u.username}</td>
        <td>${u.email}</td>
        <td>${u.status}</td>
        <td class="text-right">
          <button class="btn btn-ghost">‡∏î‡∏π</button>
          <button class="btn btn-ghost">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn btn-ghost">‡∏•‡∏ö</button>
        </td>
      </tr>
    `).join("");

    // Reports
    const reportRows = document.getElementById("reportRows");
    function renderReports(){
      const kw = (document.getElementById("filterKeyword").value||"").toLowerCase();
      const st = document.getElementById("filterStatus").value;
      const list = mockData.reports.filter(r=>{
        const matchKw = [r.id, r.reporter, r.target, r.reason].join(" ").toLowerCase().includes(kw);
        const matchSt = !st || r.status===st;
        return matchKw && matchSt;
      });
      reportRows.innerHTML = list.map(r=>`
        <tr class="border-b border-[var(--stroke)]">
          <td class="py-2">${r.id}</td>
          <td>${r.created_at}</td>
          <td>${r.reporter}</td>
          <td>${r.target}</td>
          <td>${r.reason}</td>
          <td>
            <select class="card px-2 py-1 bg-transparent">
              <option ${r.status==='‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'?'selected':''}>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
              <option ${r.status==='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'?'selected':''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
              <option ${r.status==='‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß'?'selected':''}>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option>
            </select>
          </td>
          <td class="text-right">
            <button class="btn btn-ghost">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
            <button class="btn btn-ghost">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </td>
        </tr>
      `).join("");
    }
    renderReports();
    document.getElementById("filterKeyword").addEventListener("input", renderReports);
    document.getElementById("filterStatus").addEventListener("change", renderReports);
    document.getElementById("btnClearFilter").addEventListener("click", ()=>{
      document.getElementById("filterKeyword").value="";
      document.getElementById("filterStatus").value="";
      renderReports();
    });

    // ====== Profile mock fill ======
    document.getElementById("pf_username").value = mockData.me.username;
    document.getElementById("pf_email").value = mockData.me.email;
    document.getElementById("pf_save").addEventListener("click", ()=>{
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)\n‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠ update ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á users");
    });

    // ====== Logout ======
    document.getElementById("btnLogout").addEventListener("click", ()=>{
      alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) ‚Äî ‡πÅ‡∏ô‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á /auth/logout ‡πÉ‡∏ô backend");
      // window.location.href = "/auth/logout";
    });

    // ====== Export PDF ======
    document.getElementById("btnExport").addEventListener("click", async ()=>{
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:"pt", format:"a4"});
      const now = new Date();
      const month = document.getElementById("monthPicker").value || `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
      const top = mockData.activeReaders[0];
      const open = (mockData.reportStatusCounts["‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0) + (mockData.reportStatusCounts["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0);

      doc.setFont("Helvetica","bold"); doc.setFontSize(16);
      doc.text("‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Myshelf)", 40, 60);
      doc.setFont("Helvetica",""); doc.setFontSize(12);
      doc.text(`‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${month}`, 40, 86);
      doc.text(`‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${mockData.siteTotals.total_users.toLocaleString()}`, 40, 110);
      doc.text(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${mockData.siteTotals.total_novels.toLocaleString()}`, 40, 130);
      doc.text(`‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ${open} ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏£‡∏≠ ${mockData.reportStatusCounts["‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0}, ‡∏ï‡∏£‡∏ß‡∏à‡∏≠‡∏¢‡∏π‡πà ${mockData.reportStatusCounts["‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"]||0}, ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ${mockData.reportStatusCounts["‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß"]||0})`, 40, 150);
      doc.text(`‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: ${top?top.title:"‚Äî"} (${top?top.readers:0} ‡∏Ñ‡∏ô)`, 40, 170);
      doc.line(40, 190, 555, 190);
      doc.text("‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ....................................................", 40, 220);
      doc.save(`myshelf-monthly-report-${month}.pdf`);
    });

    // ====== Demo: superadmin toggle (‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö) ======
    // userRole = "superadmin"; applyRoleGate(); document.getElementById("roleChip").textContent = "role: "+userRole;
  </script>
</body>
</html>
