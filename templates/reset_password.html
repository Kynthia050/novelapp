<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ตั้งรหัสผ่านใหม่</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme:{ extend:{ fontFamily:{ sans:['"Noto Sans Thai"','ui-sans-serif','system-ui'] }, colors:{ bg:'#1f1f21', card:'#2a2a2d' } } } }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen bg-bg text-white font-sans relative">
  <main class="w-full grid place-items-center px-4 py-16">
    <div class="w-full max-w-md bg-card/90 border border-white/10 rounded-2xl shadow-2xl p-6 sm:p-8">
      <h1 class="text-xl font-semibold mb-2">ตั้งรหัสผ่านใหม่</h1>
      <form method="post" action="{{ url_for('auth.reset_password', token=token) }}" class="space-y-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div>
          <label for="password" class="block text-sm font-medium mb-1">รหัสผ่านใหม่</label>
          <input id="password" name="password" type="password" required minlength="8"
                 pattern="(?=.*[A-Za-z])(?=.*\d).{8,}" autocomplete="new-password"
                 placeholder="อย่างน้อย 8 ตัว มีทั้งตัวอักษรและตัวเลข"
                 class="w-full rounded-full bg-[#111214] border border-white/10 px-3 py-2.5 text-white placeholder-white/40
                        focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/30 transition">
        </div>
        <div>
          <label for="password2" class="block text-sm font-medium mb-1">ยืนยันรหัสผ่านใหม่</label>
          <input id="password2" name="password2" type="password" required minlength="8" autocomplete="new-password"
                 class="w-full rounded-full bg-[#111214] border border-white/10 px-3 py-2.5 text-white placeholder-white/40
                        focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-white/30 transition"
                 placeholder="พิมพ์ซ้ำอีกครั้ง">
        </div>
        <button type="submit" class="w-full py-2.5 rounded-full bg-white text-black font-semibold shadow hover:bg-white/90">
          ตั้งรหัสผ่านใหม่
        </button>
      </form>
      <p class="mt-4 text-center text-sm">
        <a href="{{ url_for('auth.login') }}" class="underline decoration-white/30 hover:decoration-white">กลับไปหน้าเข้าสู่ระบบ</a>
      </p>
    </div>
  </main>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
<div id="toast-stack" class="fixed top-4 right-4 z-[9999] space-y-3">
  {% for category, text in messages %}
    <div
      class="toast pointer-events-auto flex w-[22rem] items-start gap-3 rounded-2xl border p-4 shadow-lg backdrop-blur
             transition-all duration-300 ease-out opacity-0 translate-y-2
             {% if category == 'success' %} bg-emerald-500/10 border-emerald-400/30 text-emerald-100 {% endif %}
             {% if category == 'error'   %} bg-rose-500/10    border-rose-400/30    text-rose-100    {% endif %}
             {% if category == 'warning' %} bg-amber-500/10   border-amber-400/30   text-amber-100   {% endif %}
             {% if category == 'info'    %} bg-sky-500/10     border-sky-400/30     text-sky-100     {% endif %}"
      role="alert"
    >
      <!-- ไอคอน -->
      <div class="mt-0.5">
        {% if category == 'success' %}
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M9 12l2 2 4-4"/><path fill="none" stroke="currentColor" stroke-width="2" d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20z"/></svg>
        {% elif category == 'error' %}
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M10 14l2-2 2 2 2-2-2-2 2-2-2-2-2 2-2-2-2 2 2 2-2 2 2 2z"/></svg>
        {% elif category == 'warning' %}
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 9h0v5h0z"/><circle cx="12" cy="17" r="1.25"/></svg>
        {% else %}
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/><rect x="11" y="10" width="2" height="6"/><rect x="11" y="7" width="2" height="2"/></svg>
        {% endif %}
      </div>

      <!-- ข้อความ -->
      <div class="flex-1 text-sm leading-5">
        {{ text }}
      </div>

      <!-- ปุ่มปิด -->
      <button type="button" class="close-toast -m-1 rounded-lg p-1/2 opacity-70 transition hover:opacity-100" aria-label="Close">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 8.586l4.95-4.95 1.414 1.414L11.414 10l4.95 4.95-1.414 1.414L10 11.414l-4.95 4.95-1.414-1.414L8.586 10l-4.95-4.95L5.05 3.636 10 8.586z" clip-rule="evenodd"/></svg>
      </button>
    </div>
  {% endfor %}
</div>

<script>
  (function () {
    const toasts = document.querySelectorAll('#toast-stack .toast');
    toasts.forEach((t, i) => {
      setTimeout(() => t.classList.remove('opacity-0','translate-y-2'), 20 + i * 60);
      const hide = () => {
        t.classList.add('opacity-0','translate-y-2');
        setTimeout(() => t.remove(), 220);
      };
      const ttl = 4000 + i * 150; // อยู่ ~4 วินาที
      let timer = setTimeout(hide, ttl);
      t.addEventListener('mouseenter', () => clearTimeout(timer));
      t.querySelector('.close-toast')?.addEventListener('click', () => { clearTimeout(timer); hide(); });
    });
  })();
</script>
{% endif %}
{% endwith %}
</body>
</html>
